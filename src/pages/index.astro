---
export const prerender = true;

import Container from "~/components/common/container.astro";
import Layout from "../layouts/Layout.astro";
import city from "~/assets/home/city.webp";
import ramen from "~/assets/home/ramen.webp";
import perspective from "~/assets/home/perspective.webp";
import back2back from "~/assets/home/back2back.webp";
// Responsive variants
import city400 from "~/assets/home/responsive/city-400.webp";
import city800 from "~/assets/home/responsive/city-800.webp";
import ramen400 from "~/assets/home/responsive/ramen-400.webp";
import ramen800 from "~/assets/home/responsive/ramen-800.webp";
import perspective400 from "~/assets/home/responsive/perspective-400.webp";
import perspective800 from "~/assets/home/responsive/perspective-800.webp";
import back2back400 from "~/assets/home/responsive/back2back-400.webp";
import back2back800 from "~/assets/home/responsive/back2back-800.webp";
import { getImage } from "astro:assets";
import { cn } from "~/lib/utils";
import BlurImage from "~/components/common/blur-image.astro";
import { generateLQIPFromPath } from "~/lib/lqip";
import path from "path";

const assetsDir = path.join(process.cwd(), "src/assets/home");

const images = await Promise.all([
  {
    src: back2back,
    src400: back2back400,
    src800: back2back800,
    alt: "back2back",
    lqip: await generateLQIPFromPath(path.join(assetsDir, "back2back.webp"), { grayscale: true }),
  },
  {
    src: perspective,
    src400: perspective400,
    src800: perspective800,
    alt: "perspective",
    lqip: await generateLQIPFromPath(path.join(assetsDir, "perspective.webp"), { grayscale: true }),
  },
  {
    src: ramen,
    src400: ramen400,
    src800: ramen800,
    alt: "ramen",
    lqip: await generateLQIPFromPath(path.join(assetsDir, "ramen.webp"), { grayscale: true }),
  },
  {
    src: city,
    src400: city400,
    src800: city800,
    alt: "city",
    lqip: await generateLQIPFromPath(path.join(assetsDir, "city.webp"), { grayscale: true }),
  },
]);

const birthDate = new Date("2007-08-28");
const today = new Date();

const age =
  today.getMonth() > birthDate.getMonth() ||
  (today.getMonth() === birthDate.getMonth() &&
    today.getDate() >= birthDate.getDate())
    ? today.getFullYear() - birthDate.getFullYear()
    : today.getFullYear() - birthDate.getFullYear() - 1;
---

<Layout
  content={{
    title: "home | advtszn",
    description: `${age} year old multi-disciplinary engineer, obsessed with scale, speed and aesthetics`,
  }}
>
  <main class="">
    <Container>
      <div
        class="flex flex-col space-y-6 lg:flex-row lg:items-start lg:justify-between lg:space-y-0"
      >
        <div class="space-y-8 lg:max-w-[45%] lg:pl-4">
          <div class="space-y-2 font-light">
            <h1 class="font-serif text-4xl italic md:text-6xl">
              advait <span class="text-xl md:text-4xl">(advtszn)</span>
            </h1>
            <p
              class="font-serif text-2xl leading-[120%] [word-spacing:0.15rem] md:text-4xl"
            >
              {age} y/o multi-disciplinary engineer, obsessed with scale, speed and
              aesthetics
            </p>
          </div>
          <div class="text-muted-foreground space-y-4 text-lg">
            <p>
              i love doing things that look good while doing it. im really
              obsessive about good design, typography and ux (in pretty much
              everything around me)
            </p>
            <p>
              i've worked across multiple startups as an intern, freelancer or
              part-timer &mdash; always gravitating toward projects where design
              and engineering overlap.
            </p>
            <p>
              outside tech, Iâ€™ve always had this itch for creative stuff &mdash;
              i used to post anime edits, played around with graphics, even
              tried music production for a bit.
            </p>
            <p>
              i have a leaning towards the mix of tech and creativity, bcs i
              believe good taste is a real differentiator.
            </p>
          </div>
        </div>

        <div
          id="masonry"
          class={cn(
            "gap-x-2 leading-0 ",
            "[-moz-column-count:2] [-moz-column-gap:8px] [-webkit-column-count:2] [-webkit-column-gap:8px] [column-count:2]",
            "md:[-moz-column-count:3]  md:[-webkit-column-count:3] md:[column-count:3]",
            "lg:[-moz-column-count:2]  lg:[-webkit-column-count:2] lg:[column-count:2]",
          )}
        >
          {
            images.map(async ({ src, src400, src800, alt, lqip }) => {
              const webpImage = await getImage({ src, format: "webp" });
              const webp400 = await getImage({ src: src400, format: "webp" });
              const webp800 = await getImage({ src: src800, format: "webp" });
              const srcset = `${webp400.src} 400w, ${webp800.src} 800w, ${webpImage.src} 1200w`;

              return (
                <BlurImage
                  src={webpImage.src}
                  srcset={srcset}
                  sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
                  lqip={lqip}
                  alt={alt}
                  width={src.width}
                  height={src.height}
                  class="mb-2 h-auto md:w-3xs cursor-zoom-in rounded grayscale"
                  grayscalePlaceholder={true}
                  data-full={webpImage.src}
                />
              );
            })
          }
        </div>
      </div>

      <div
        id="previewModal"
        class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80"
      >
        <img
          id="previewImg"
          src=""
          alt="full preview"
          class="max-h-[90%] max-w-[90%] rounded-lg shadow-lg"
        />
      </div>
    </Container>
  </main>
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const modal = document.getElementById("previewModal");
    const previewImg = document.getElementById("previewImg") as HTMLImageElement;
    const images = document.querySelectorAll("#masonry .blur-image-wrapper");

    images.forEach((img) => {
      img.addEventListener("click", () => {
        const fullSrc = img.getAttribute("data-full");
        if (fullSrc && modal && previewImg) {
          previewImg.src = fullSrc;
          modal.classList.remove("hidden");
          modal.classList.add("flex");
        }
      });
    });

    modal?.addEventListener("click", () => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    });
  });
</script>
